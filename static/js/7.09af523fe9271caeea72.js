webpackJsonp([7],{"4/nJ":function(t,e){},DErQ:function(t,e){},mFEY:function(t,e){},p35r:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("s0MJ"),o=s("Cz8s"),i=s("NYxO"),n={props:["history","chatShow"],name:"heads",computed:Object(i.b)({detail:function(t){return t.linkDoctorView}}),data:function(){return{vociceOpen:!0,info:"6年专业从医经验，耐心，解答详细",show:!1,timer:null,count:""}},methods:{detailView:function(){this.$router.push({name:"detail",params:{detail:this.detail}})},linkDoctorTime:function(){var t=this;this.timer||(this.count=5,this.show=!1,this.timer=setInterval(function(){t.count>0&&t.count<=5?t.count--:(t.show=!0,clearInterval(t.timer),t.timer=null,t.$store.commit("setAskModal",!1))},1e3)),"history"===this.$route.params.from&&(this.show=!0)}},created:function(){this.chatShow&&(this.show=!0)},updated:function(){this.$store.state.askModal&&this.linkDoctorTime()}},r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.show?s("section",{staticClass:"top waiting",on:{click:t.detailView}},[this.$store.state.linkDoctorView?[s("div",{staticClass:"left"},[s("img",{staticClass:"head",attrs:{src:t.detail.image}})]),t._v(" "),s("div",{staticClass:"right"},[s("div",{staticClass:"name"},[s("span",[t._v(t._s(t.detail.name))]),t._v(" "),s("span",[t._v(t._s(t.detail.clinicName))]),t._v(" "),s("span",[t._v(t._s(t.detail.title))])]),t._v(" "),s("small",[t._v(t._s(t.info))])])]:[s("div",[t._v("暂无医生接入")])]],2):s("section",{staticClass:"top waiting"},[s("div",[t._v("正在为您转接"+t._s(t.count)+" s")]),t._v(" "),s("div",{staticStyle:{display:"none"}},[t._v(t._s(this.$store.state.askModal))])])};r._withStripped=!0;var c={render:r,staticRenderFns:[]},l=c;var d=!1;var h=s("VU/8")(n,l,!1,function(t){d||s("4/nJ")},"data-v-0a936333",null);h.options.__file="src\\components\\Heads.vue";var m=h.exports,u=s("Au9i"),p=s("RkLV"),v={props:["type","history"],name:"chatlist",computed:Object(i.b)({createProblem:function(t){return t.createProblem},doctorView:function(t){return t.doctorView},doctorHistory:function(t){return t.doctorHistory},detail:function(t){return t.linkDoctorView}}),data:function(){return{doctor:{},appendProblem:{id:2,text:"",state:!1},showSelBox:0,selFace:"表情",selOther:"其他功能",content:"",topStatus:"",records:[]}},methods:{sendMsg:function(){""!=this.content?(this.appendMsg(),this.scrollToBottom()):Object(u.Toast)("请输入消息")},sendPro:function(t){this.$store.commit("pushMessage",{person:"p",gmtCreate:a.a.formatDate.format(new Date,"yyyy-MM-dd hh:mm:ss"),contentId:"",content:t}),this.scrollToBottom()},appendMsg:function(){var t=this;Object(p.b)({param:{accountId:this.appendProblem.id,content:this.content,questionId:this.createProblem.id}}).then(function(e){0===e.data.code?(t.$store.commit("pushMessage",{person:"p",gmtCreate:a.a.formatDate.format(new Date,"yyyy-MM-dd hh:mm:ss"),contentId:"",content:t.content}),t.content=""):t.$toast("发送失败!")})},formatDate:function(t){return a.a.formatDate.format(new Date(t),"yyyy-MM-dd hh:mm:ss")},detectRes:function(){console.log("检测结果")},toAssess:function(){this.$router.push("/evaluate")},focusTxtContent:function(){document.querySelector("#txtContent input").focus()},scrollToBottom:function(){setTimeout(function(){var t=document.getElementsByClassName("chatlist")[0];t.scrollTop=t.scrollHeight},100)},handleTopChange:function(t){this.topStatus=t},loadTop:function(t){var e=this,s=this;setTimeout(function(){var o=document.getElementsByClassName("chatlist")[0],i=o.scrollHeight;s.records.unshift({type:1,time:a.a.formatDate.format(new Date,"yyyy-MM-dd hh:mm:ss"),name:"",content:"这里是历史记录"},{type:2,time:a.a.formatDate.format(new Date,"yyyy-MM-dd hh:mm:ss"),name:"",content:"历史记录"}),setTimeout(function(){var t=o.scrollHeight;o.scrollTop=t-i},100),e.$refs.loadmore.onTopLoaded(t)},1500)},showEvaluate:function(){return"c"===this.$store.state.askProblemStatus&&(!!this.$store.state.assessed||void 0)}},mounted:function(){switch(this.scrollToBottom(),this.focusTxtContent(),this.type){case"create":this.$store.commit("setDoctorHistory",[]);break;case"history":this.createProblem.id=this.$route.params.list.id}},updated:function(){this.scrollToBottom()},created:function(){}},f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"charconwarp"},[a("section",{staticClass:"chatlist",class:t.showSelBox>0?"chatlist-bottom-collapse":"chatlist-bottom"},[a("mt-loadmore",{ref:"loadmore",attrs:{"top-method":t.loadTop,"top-pull-text":"加载更多","top-drop-text":"释放加载"},on:{"top-status-change":t.handleTopChange}},[a("ul",[t._l(t.doctorHistory,function(e){return["p"===e.person?a("li",{staticClass:"chat-mine"},[a("div",{staticClass:"chat-user"},[a("img",{attrs:{src:s("8tHC")}})]),t._v(" "),a("div",{staticClass:"time"},[a("cite",[a("i",[t._v(t._s(t.formatDate(e.gmtCreate)))])])]),t._v(" "),a("div",{staticClass:"chat-text"},[t._v(t._s(e.content))])]):t._e(),t._v(" "),"d"===e.person?a("li",[a("div",{staticClass:"chat-user"},[a("img",{attrs:{src:t.detail.image}})]),t._v(" "),a("div",{staticClass:"time"},[a("cite",[t._v(t._s(t.detail&&t.detail.name)),a("i",[t._v(t._s(t.formatDate(e.gmtCreate)))])])]),t._v(" "),"text"===e.type?a("div",{staticClass:"chat-text"},[t._v(t._s(e.content))]):"image"===e.type?a("div",{staticClass:"chat-text"},[a("img",{attrs:{src:e.content,alt:""}})]):"audio"===e.type?a("div",{staticClass:"chat-text"},[a("audio",{attrs:{controls:"controls",preload:"auto",src:e.content}})]):t._e()]):t._e()]})],2)])],1),t._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:"n"===this.$store.state.askProblemStatus||("a"===this.$store.state.askProblemStatus||"s"===this.$store.state.askProblemStatus),expression:"\n  this.$store.state.askProblemStatus==='n'?true:\n  this.$store.state.askProblemStatus==='a'?true:\n  this.$store.state.askProblemStatus==='s'?true:false"}],staticClass:"foot"},[a("mt-field",{staticClass:"con",attrs:{id:"txtContent",placeholder:""},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),t._v(" "),a("div",{staticClass:"sendgroup"},[a("span",{staticClass:"btn btn-detectRes",on:{click:t.detectRes}},[t._v("检测结果")]),t._v(" "),a("span",{staticClass:"btn btn-send",on:{click:t.sendMsg}},[t._v("发送")])])],1),t._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:"c"===this.$store.state.askProblemStatus&&!this.$store.state.assessed,expression:"this.$store.state.askProblemStatus==='c'&&!this.$store.state.assessed"}],staticClass:"evaluate"},[a("mt-button",{attrs:{type:"primary",size:"large"},on:{click:t.toAssess}},[t._v("立即评价")])],1)])};f._withStripped=!0;var _={render:f,staticRenderFns:[]},C=_;var b=!1;var w=s("VU/8")(v,C,!1,function(t){b||s("DErQ")},null,null);w.options.__file="src\\components\\ChatList.vue";var y={name:"chat",components:{Heads:m,ChatList:w.exports,HEADER:o.a},data:function(){return{from:"",createProblem:{id:2,text:"",state:!1},list:{},doctor:{},popupVisible:!1,sexSlots:[{flex:1,values:["男","女"],className:"sexSlot"}],askContent:"",askContentFlag:!1,placeholder:"请输入您想咨询的问题：比如糖尿病。",chatShow:!1,age:{data:null,state:!1},sex:{data:"男",state:!0}}},watch:{askContent:function(){/[\u4e00-\u9fa5|\u3002|\uff1f|\uff0c]{10,}/.test(this.askContent)?this.askContentFlag=!0:this.askContentFlag=!1},"age.data":function(){/^[0-9]{1,2}$/.test(this.age.data)?this.age.state=!0:this.age.state=!1},"sex.data":function(){/^['男'|'女']$/.test(this.sex.data)?this.sex.state=!0:this.sex.state=!1}},methods:{doctorDetail:function(t){var e=this;Object(p.d)({questionId:t}).then(function(t){0===t.data.code&&e.$store.commit("setLinkDoctorView",t.data.body)})},cancel:function(){this.$cuteModal.hide("askModal"),this.$router.push("/")},onSexChange:function(t,e){this.sex.data=e[0]},confirm:function(){this.age.state?this.sex.state?this.askContent?this.askContentFlag&&this.age.state&&this.sex.state?this.createProblemId():this.$toast("请输入有效问题!"):(this.placeholder="请输入您的问题!",this.$toast("请输入您的问题!")):this.$toast("请输入正确的性别!"):this.$toast("请输入正确的年龄!")},createProblemId:function(){var t=this;Object(p.c)({param:{accountId:this.createProblem.id,age:parseInt(this.age.data),content:this.askContent,gender:this.sex.data,testUserId:this.createProblem.id}}).then(function(e){0===e.data.code&&(t.$store.commit("setCreateProblem",e.data.body),t.doctorDetail(t.$store.state.createProblem.id),t.$cuteModal.hide("askModal"),t.$store.commit("setAskModal",!0),t.chatShow=!0,t.$store.commit("pushMessage",{person:"p",gmtCreate:a.a.formatDate.format(new Date,"yyyy-MM-dd hh:mm:ss"),contentId:"",content:t.askContent}))})},loadProblemList:function(t){var e=this;Object(p.f)({param:{accountId:0,lastContentId:0,questionId:t}}).then(function(t){0===t.data.code?(e.$store.commit("setLinkDoctorView",t.data.body.doctorInfo),e.$store.commit("setDoctorHistory",t.data.body.metaItemDetailResultList),e.$store.commit("setAskProblemStatus",t.data.body.question.status),e.$store.commit("setAssessed",t.data.body.question.assessed)):e.$toast("加载历史记录失败!")})}},created:function(){this.from=this.$route.params.from,this.createProblem.text=this.$route.params.create,this.list=this.$route.params.list;var t=this.$route.query.qid;"create"===this.from||(t?this.doctorDetail(t):this.doctorDetail(this.$store.state.createProblem.id),this.chatShow=!0)},mounted:function(){"create"===this.from&&(this.$store.commit("setAskModal",!1),this.$cuteModal.open("askModal"));var t=this.$route.query.qid;t&&this.loadProblemList(t)}},g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"chat"}},[s("HEADER"),t._v(" "),s("Heads",{directives:[{name:"show",rawName:"v-show",value:t.chatShow,expression:"chatShow"}],attrs:{detail:t.doctor,history:t.list,chatShow:t.chatShow}}),t._v(" "),s("ChatList",{directives:[{name:"show",rawName:"v-show",value:t.chatShow,expression:"chatShow"}],attrs:{type:t.from,history:t.list,chatShow:t.chatShow}}),t._v(" "),s("cute-modal",{ref:"modal",staticClass:"askModal",attrs:{name:"askModal"}},[s("div",{staticClass:"header"},[s("h4",[t._v("医生问诊")]),t._v(" "),s("nav",{staticClass:"modal-nav"},[s("a",{staticClass:"nav-item checked",attrs:{href:"#"}},[t._v("导诊接待")]),s("i",[t._v(">")]),t._v(" "),s("a",{staticClass:"nav-item",attrs:{href:"#"}},[t._v("安排医生")]),s("i",[t._v(">")]),t._v(" "),s("a",{staticClass:"nav-item",attrs:{href:"#"}},[t._v("医生诊断")])])]),t._v(" "),s("div",{staticClass:"con"},[s("div",{staticClass:"profile"},[s("mt-field",{attrs:{label:"年 龄:",disableClear:"",attr:{maxlength:2}},model:{value:t.age.data,callback:function(e){t.$set(t.age,"data",e)},expression:"age.data"}}),t._v(" "),s("mt-cell",{staticClass:"sexWarp",attrs:{title:"性 别:",value:t.sex.data},nativeOn:{click:function(e){t.popupVisible=!0}}}),t._v(" "),s("mt-popup",{staticClass:"popup",attrs:{position:"bottom"},model:{value:t.popupVisible,callback:function(e){t.popupVisible=e},expression:"popupVisible"}},[s("mt-picker",{attrs:{slots:t.sexSlots,"visible-item-count":5,"show-toolbar":!1},on:{change:t.onSexChange}})],1)],1),t._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.askContent,expression:"askContent"}],staticClass:"modal-con",attrs:{rows:"8",cols:"30",placeholder:t.placeholder,autofocus:"autofocus"},domProps:{value:t.askContent},on:{input:function(e){e.target.composing||(t.askContent=e.target.value)}}})]),t._v(" "),s("div",{staticClass:"footer"},[s("div",{staticClass:"cancel",on:{click:t.cancel}},[t._v("取消问诊")]),t._v(" "),s("div",{staticClass:"confirm",on:{click:t.confirm}},[t._v("立即问诊")])])])],1)};g._withStripped=!0;var k={render:g,staticRenderFns:[]},$=k;var x=!1;var S=s("VU/8")(y,$,!1,function(t){x||s("mFEY")},null,null);S.options.__file="src\\views\\container\\chat.vue";e.default=S.exports}});
//# sourceMappingURL=7.09af523fe9271caeea72.js.map